"use strict";(self.webpackChunknym_docs=self.webpackChunknym_docs||[]).push([[3870],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return c}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=d(n),c=o,h=u["".concat(s,".").concat(c)]||u[c]||p[c]||r;return n?a.createElement(h,i(i({ref:t},m),{},{components:n})):a.createElement(h,i({ref:t},m))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var d=2;d<r;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9879:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return m},default:function(){return u}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],l={sidebar_label:"Validators",description:"Nym Validators provide privacy-enhanced credentials based on the testimony of a set of decentralized, blockchain-based issuing authorities.",hide_title:!1,title:"Validators"},s=void 0,d={unversionedId:"run-nym-nodes/validators",id:"run-nym-nodes/validators",isDocsHomePage:!1,title:"Validators",description:"Nym Validators provide privacy-enhanced credentials based on the testimony of a set of decentralized, blockchain-based issuing authorities.",source:"@site/docs/run-nym-nodes/validators.md",sourceDirName:"run-nym-nodes",slug:"/run-nym-nodes/validators",permalink:"/docs/current/run-nym-nodes/validators",version:"current",lastUpdatedAt:1629392756,formattedLastUpdatedAt:"8/19/2021",frontMatter:{sidebar_label:"Validators",description:"Nym Validators provide privacy-enhanced credentials based on the testimony of a set of decentralized, blockchain-based issuing authorities.",hide_title:!1,title:"Validators"},sidebar:"sidebar",previous:{title:"Mixnodes",permalink:"/docs/current/run-nym-nodes/mixnodes"},next:{title:"Requesters",permalink:"/docs/current/run-nym-nodes/requester"}},m=[{value:"Building the Nym validator",id:"building-the-nym-validator",children:[]},{value:"Initializing your validator",id:"initializing-your-validator",children:[]},{value:"Setting up your validator&#39;s admin user",id:"setting-up-your-validators-admin-user",children:[]},{value:"Starting your validator",id:"starting-your-validator",children:[]},{value:"Automating your validator with systemd",id:"automating-your-validator-with-systemd",children:[]},{value:"Installing and configuring nginx for HTTPS",id:"installing-and-configuring-nginx-for-https",children:[]},{value:"Configuring Prometheus metrics (optional)",id:"configuring-prometheus-metrics-optional",children:[]},{value:"Unjailing your validator",id:"unjailing-your-validator",children:[]},{value:"Day 2 operations with your validator",id:"day-2-operations-with-your-validator",children:[]},{value:"Validator port reference",id:"validator-port-reference",children:[]}],p={toc:m};function u(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Nym validators secure the network with a staking token, defending the network from Sybil attacks."),(0,r.kt)("p",null,"Validators also provide privacy-enhanced credentials based on the testimony of a set of decentralized, blockchain-based issuing authorities. Nym validators use a ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Digital_signature"},"signature scheme")," called ",(0,r.kt)("a",{parentName:"p",href:"https://arxiv.org/abs/1802.07344"},"Coconut")," to issue credentials. This allows privacy apps to generate anonymous resource claims through decentralised authorities, then use them with Service Providers."),(0,r.kt)("p",null,"The validator is built using ",(0,r.kt)("a",{parentName:"p",href:"https://cosmos.network"},"Cosmos SDK")," and ",(0,r.kt)("a",{parentName:"p",href:"https://tendermint.com"},"Tendermint"),", with a ",(0,r.kt)("a",{parentName:"p",href:"https://cosmwasm.com"},"CosmWasm")," smart contract controlling the directory service, node bonding, and delegated mixnet staking."),(0,r.kt)("h3",{id:"building-the-nym-validator"},"Building the Nym validator"),(0,r.kt)("h4",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"git"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt update\nsudo apt install git\n")),(0,r.kt)("p",null,"Verify ",(0,r.kt)("inlineCode",{parentName:"p"},"git")," is installed with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"git version\n# Should return: git version X.Y.Z\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Go >= v1.15"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Go")," can be installed via the following commands (taken from the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Agoric/agoric-sdk/wiki/Validator-Guide-for-Incentivized-Testnet#install-go"},"Agoric SDK docs"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# First remove any existing old Go installation\nsudo rm -rf /usr/local/go\n\n# Install correct Go version\ncurl https://dl.google.com/go/<CORRECT.GO.VERSION>.linux-amd64.tar.gz | sudo tar -C/usr/local -zxvf -\n\n# Update environment variables to include go\ncat <<'EOF' >>$HOME/.profile\nexport GOROOT=/usr/local/go\nexport GOPATH=$HOME/go\nexport GO111MODULE=on\nexport PATH=$PATH:/usr/local/go/bin:$HOME/go/bin\nEOF\nsource $HOME/.profile\n")),(0,r.kt)("p",null,"Remember to replace ",(0,r.kt)("inlineCode",{parentName:"p"},"<CORRECT.GO.VERSION>")," with the version of your choice from the Go releases page. For example:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"<CORRECT.GO.VERSION>.linux-amd64.tar.gz")," becomes ",(0,r.kt)("inlineCode",{parentName:"p"},"go1.15.7.linux-amd64.tar.gz")),(0,r.kt)("p",null,"Verify ",(0,r.kt)("inlineCode",{parentName:"p"},"Go")," is installed with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"go version\n# Should return: go version go1.15.7 linux/amd64\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"gcc"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"gcc")," can be installed with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt install build-essential\n# Optional additional manual pages can be installed with:\nsudo apt-get install manpages-dev\n")),(0,r.kt)("p",null,"Verify ",(0,r.kt)("inlineCode",{parentName:"p"},"gcc")," is installed with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"gcc --version\n")),(0,r.kt)("p",null,"Which should return something like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"gcc (Ubuntu 7.4.0-1ubuntu1~18.04) 7.4.0\nCopyright (C) 2017 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n")),(0,r.kt)("h4",{id:"building-your-validator"},"Building your validator"),(0,r.kt)("p",null,"We use the ",(0,r.kt)("inlineCode",{parentName:"p"},"wasmd")," version of the Cosmos validator to run our blockchain. Run this to clone, compile, and build it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'WASMD_VERSION=v0.17.0\nBECH32_PREFIX=punk\ngit clone https://github.com/CosmWasm/wasmd.git\ncd wasmd\ngit checkout ${WASMD_VERSION}\nmkdir build\ngo build -o build/nymd -mod=readonly -tags "netgo,ledger" -ldflags "-X github.com/cosmos/cosmos-sdk/version.Name=nymd -X github.com/cosmos/cosmos-sdk/version.AppName=nymd -X github.com/CosmWasm/wasmd/app.NodeDir=.nymd -X github.com/cosmos/cosmos-sdk/version.Version=${WASMD_VERSION} -X github.com/cosmos/cosmos-sdk/version.Commit=1920f80d181adbeaedac1eeea1c1c6e1704d3e49 -X github.com/CosmWasm/wasmd/app.Bech32Prefix=${BECH32_PREFIX} -X \'github.com/cosmos/cosmos-sdk/version.BuildTags=netgo,ledger\'" -trimpath ./cmd/wasmd # noqa line-length\n')),(0,r.kt)("p",null,"At this point, you will have a copy of the ",(0,r.kt)("inlineCode",{parentName:"p"},"nymd")," binary in your ",(0,r.kt)("inlineCode",{parentName:"p"},"build/")," directory. Test that it's compiled properly by running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"./build/nymd\n")),(0,r.kt)("p",null,"You should see ",(0,r.kt)("inlineCode",{parentName:"p"},"nymd")," help text print out."),(0,r.kt)("p",null,"Both the ",(0,r.kt)("inlineCode",{parentName:"p"},"nymd")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"libwasmvm.so")," shared object library binary have been compiled. ",(0,r.kt)("inlineCode",{parentName:"p"},"libwasmvm.so")," is the wasm virtual machine which is needed to execute Nym smart contracts."),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If you have compiled these files locally you need to upload both of them to the server on which the validator will run. ",(0,r.kt)("strong",{parentName:"p"},"If you have instead compiled them on the server skip to the step outlining setting ",(0,r.kt)("inlineCode",{parentName:"strong"},"LD_LIBRARY PATH")," below.")))),(0,r.kt)("p",null,"To locate these files on your local system run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"WASMVM_SO=$(ldd build/nymd | grep libwasmvm.so | awk '{ print $3 }')\nls ${WASMVM_SO}\n")),(0,r.kt)("p",null,"This will output something like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"'/home/username/go/pkg/mod/github.com/!cosm!wasm/wasmvm@v0.13.0/api/libwasmvm.so'\n")),(0,r.kt)("p",null,"When you upload your ",(0,r.kt)("inlineCode",{parentName:"p"},"nymd")," binary, you'll need to tell it where ",(0,r.kt)("inlineCode",{parentName:"p"},"libwasmvm.so")," is when you start your validator, or ",(0,r.kt)("inlineCode",{parentName:"p"},"nymd")," will not run. If you have compiled them on your server then this is not necessary, as the compiled ",(0,r.kt)("inlineCode",{parentName:"p"},"nymd")," already has access to ",(0,r.kt)("inlineCode",{parentName:"p"},"libwasmvm.so"),"."),(0,r.kt)("p",null,"Alternatively, you can check out the repository for ",(0,r.kt)("inlineCode",{parentName:"p"},"nym")," at ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nymtech/nym"},"https://github.com/nymtech/nym")," and use the tag for the current release with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"git clone https://github.com/nymtech/nym.git\ncd nym\ngit reset --hard   # in case you made any changes on your branch\ngit pull           # in case you've checked it out before\ngit checkout tags/v0.11.0\n")),(0,r.kt)("p",null,"Inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"validator")," directory you will find the precompiled binaries to use."),(0,r.kt)("p",null,"Upload both ",(0,r.kt)("inlineCode",{parentName:"p"},"nymd")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"libwasmvm.so")," to your validator machine. If you attempt to run ",(0,r.kt)("inlineCode",{parentName:"p"},"./nymd")," on your server, you'll likely see an error if ",(0,r.kt)("inlineCode",{parentName:"p"},"nymd")," can't find ",(0,r.kt)("inlineCode",{parentName:"p"},"libwasmvm.so"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"./nymd: error while loading shared libraries: libwasmvm.so: cannot open shared object file: No such file or directory\n")),(0,r.kt)("p",null,"You'll need to set ",(0,r.kt)("inlineCode",{parentName:"p"},"LD_LIBRARY_PATH")," in your user's ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.bashrc")," file, and add that to our path. Replace ",(0,r.kt)("inlineCode",{parentName:"p"},"/home/youruser/path/to/nym/binaries")," in the command below to the locations of ",(0,r.kt)("inlineCode",{parentName:"p"},"nymd")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"libwasmvm.so")," and run it. If you have compiled these on the server, they will be in the ",(0,r.kt)("inlineCode",{parentName:"p"},"build/")," folder:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"NYM_BINARIES=/home/youruser/path/to/nym/binaries\necho 'export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:'NYM_BINARIES >> ~/.bashrc\necho 'export PATH=$PATH:'${NYM_BINARIES} >> ~/.bashrc\nsource ~/.bashrc\n")),(0,r.kt)("p",null,"Test everything worked:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"nymd\n")),(0,r.kt)("p",null,"This should return the regular ",(0,r.kt)("inlineCode",{parentName:"p"},"nymd")," help text."),(0,r.kt)("h3",{id:"initializing-your-validator"},"Initializing your validator"),(0,r.kt)("p",null,"Prerequisites:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"FQDN Domain name"),(0,r.kt)("li",{parentName:"ul"},"IPv4 and IPv6 connectivity")),(0,r.kt)("p",null,"Choose a name for your validator and use it in place of ",(0,r.kt)("inlineCode",{parentName:"p"},"yourname")," in the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"nymd init yourname --chain-id testnet-milhon\n")),(0,r.kt)("p",null,"At this point, you have a new validator, with its own genesis file located at ",(0,r.kt)("inlineCode",{parentName:"p"},"$HOME/.nymd/config/genesis.json"),". You will need to ",(0,r.kt)("strong",{parentName:"p"},"replace the contents of that file")," that with Nym's ",(0,r.kt)("a",{parentName:"p",href:"https://nymtech.net/testnets/milhon/genesis.json"},"testnet-milhon genesis file"),"."),(0,r.kt)("p",null,"You can use the following command to download the one for Milhon:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"wget  -O $HOME/.nymd/config/genesis.json https://nymtech.net/testnets/milhon/genesis.json\n")),(0,r.kt)("h4",{id:"configtoml-configuration"},(0,r.kt)("inlineCode",{parentName:"h4"},"config.toml")," configuration"),(0,r.kt)("p",null,"Add the Nym validator as a persistent peer so that your validator can start pulling blocks from the rest of the network, by editing the following config options in ",(0,r.kt)("inlineCode",{parentName:"p"},"$HOME/.nymd/config/config.toml")," to match the information below:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'cors_allowed_origins = ["*"]')," allows the web wallet to make HTTPS requests to your validator."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'persistent_peers = "d6265e7c885eda002ef8736d2270bcbfb346a3aa@testnet-milhon-validator1.nymtech.net:26656"')," allows your validator to start pulling blocks from other validators"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"create_empty_blocks = false")," may save a bit of space"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'laddr = "tcp://0.0.0.0:26656"')," in your ",(0,r.kt)("inlineCode",{parentName:"li"},"p2p configuration options")," ")),(0,r.kt)("p",null,"Optionally, if you want to enable ",(0,r.kt)("a",{parentName:"p",href:"https://prometheus.io/"},"Prometheus")," metrics then the following must also match in the ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"prometheus = true")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'prometheus_listen_addr = ":26660"'))),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Remember to enable metrics in the 'Configuring Prometheus metrics' section below as well."))),(0,r.kt)("p",null,"And if you wish to add a human-readable moniker to your node:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'moniker = "yourname"'))),(0,r.kt)("p",null,"Finally, if you plan on using ",(0,r.kt)("a",{parentName:"p",href:"https://cockpit-project.org/documentation.html"},"Cockpit")," on your server, change the ",(0,r.kt)("inlineCode",{parentName:"p"},"grpc")," port from ",(0,r.kt)("inlineCode",{parentName:"p"},"9090")," as this is the port used by Cockpit."),(0,r.kt)("h4",{id:"apptoml-configuration"},(0,r.kt)("inlineCode",{parentName:"h4"},"app.toml")," configuration"),(0,r.kt)("p",null,"In the file ",(0,r.kt)("inlineCode",{parentName:"p"},"$HOME/.nymd/config/app.toml"),", set the following values:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},'minimum-gas-prices = "0.025upunk"')),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"enable = true")," in the ",(0,r.kt)("inlineCode",{parentName:"li"},"[api]")," section to get the API server running")),(0,r.kt)("h3",{id:"setting-up-your-validators-admin-user"},"Setting up your validator's admin user"),(0,r.kt)("p",null,"You'll need an admin account to be in charge of your validator. Set that up with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"nymd keys add nymd-admin\n")),(0,r.kt)("p",null,"This will add keys for your administrator account to your system's keychain."),(0,r.kt)("p",null,"The command output should look something like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'$ nymd keys add nymd-admin\nEnter keyring passphrase:\npassword must be at least 8 characters\nEnter keyring passphrase:\nRe-enter keyring passphrase:\n\n- name: nymd-admin\ntype: local\naddress: punk1x4twq82ew2c49ctr36mafksyrtnxwvrkey939u\npubkey: punkpub1addwnpepqdfcf5786qry8g8ef9nad5vnl0rs5cmkcywzrwwvvdye27ktjmqw2ygr2hr\nmnemonic: ""\nthreshold: 0\npubkeys: []\n\n\n**Important** write this mnemonic phrase in a safe place.\nIt is the only way to recover your account if you ever forget your password.\n\ndesign payment apple input doll left badge never toe claw coconut neither travel side castle know plate unit mercy weekend pelican stay fortune road\n')),(0,r.kt)("p",null,"As the instructions say, remember to ",(0,r.kt)("strong",{parentName:"p"},"write down your mnemonic"),"."),(0,r.kt)("p",null,"You can get the admin account's address with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"nymd keys show nymd-admin -a\n")),(0,r.kt)("p",null,"Type in your keychain ",(0,r.kt)("strong",{parentName:"p"},"password"),", not the mnemonic, when asked. The output should look something like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"punk1x4twq82ew2c49ctr36mafksyrtnxwvrkey939u\n")),(0,r.kt)("h3",{id:"starting-your-validator"},"Starting your validator"),(0,r.kt)("p",null,"Everything should now be ready to go. You've got the validator set up, all changes made in ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"app.toml"),", the Nym genesis file copied into place (replacing the initial auto-generated one). Now let's validate the whole setup:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"nymd validate-genesis\n")),(0,r.kt)("p",null,"If this check passes, you should receive the following output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"File at /path/to/.nymd/config/genesis.json is a valid genesis file\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If this test did not pass, check that you have replaced the contents of ",(0,r.kt)("inlineCode",{parentName:"p"},"/path/to/.nymd/config/genesis.json")," with that of the ",(0,r.kt)("a",{parentName:"p",href:"https://nymtech.net/testnets/milhon/genesis.json"},"testnet-milhon genesis file"),".")),(0,r.kt)("p",null,"Before starting the validator, we will need to open the firewall ports:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"# if ufw is not already installed:\nsudo apt install ufw\nsudo ufw enable\nsudo ufw allow 1317,26656,26660,22,80,443,8000,1790/tcp\n# to check everything worked\nsudo ufw status\n")),(0,r.kt)("p",null,"Ports ",(0,r.kt)("inlineCode",{parentName:"p"},"22"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"80"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"443")," are for ssh, http, and https connections respectively. ",(0,r.kt)("inlineCode",{parentName:"p"},"8000")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"1790")," are for VerLoc, our node location system, and the rest of the ports are documented ",(0,r.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/v0.42/core/grpc_rest.html"},"here"),"."),(0,r.kt)("p",null,"For more information about your validator's port configuration, check the ",(0,r.kt)("a",{parentName:"p",href:"#validator-port-reference"},"validator port reference table")," below."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you are planning to use ",(0,r.kt)("a",{parentName:"p",href:"https://cockpit-project.org/"},"Cockpit")," on your validator server then you will have defined a different ",(0,r.kt)("inlineCode",{parentName:"p"},"grpc")," port in your ",(0,r.kt)("inlineCode",{parentName:"p"},"config.toml")," above: remember to open this port as well.")),(0,r.kt)("p",null,"Start the validator:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"nymd start\n")),(0,r.kt)("p",null,"Once your validator starts, it will start requesting blocks from other validators. This may take several hours. Once it's up to date, you can issue a request to join the validator set:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'PUB_KEY=$(/home/youruser/path/to/nym/binaries/nymd tendermint show-validator) # e.g. punkvalconspub1zcjduepqzw38hj6edjc5wldj3d37hwc4savn0t95uakhy6tmeqqz5wrfmntsnyehsq\nMONIKER="nym-secondary"                                                       # whatever you called your validator\nFROM_ACCOUNT="nymd-admin"                                                     # your keychain name\n\nnymd tx staking create-validator \\\n--amount=10000000stake \\\n--fees=5000upunk \\\n--pubkey="${PUB_KEY}" \\\n--moniker=${MONIKER} \\\n--chain-id=testnet-milhon \\\n--commission-rate="0.10" \\\n--commission-max-rate="0.20" \\\n--commission-max-change-rate="0.01" \\\n--min-self-delegation="1" \\\n--gas="auto" \\\n--gas-adjustment=1.15 \\\n--from=${FROM_ACCOUNT} \\\n--node https://testnet-milhon-validator.nymtech.net:443\n')),(0,r.kt)("p",null,"You'll need ",(0,r.kt)("inlineCode",{parentName:"p"},"stake")," coins for this."),(0,r.kt)("p",null,"Note: we are currently working towards building up a closed set of reputable validators. You can ask us for coins to get in, but please don't be offended if we say no - validators are part of our system's core security and we are starting out with people we already know or who have a solid reputation."),(0,r.kt)("p",null,"If you want to edit some details for your node you will use a command like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'nymd tx staking edit-validator   --chain-id=testnet-milhon   --moniker=${MONIKER}   --details="Nym validator"   --security-contact="YOUREMAIL"   --identity="XXXXXXX"   --gas="auto"   --gas-adjustment=1.15   --from=${FROM_ACCOUNT} --fees 2000upunk\n')),(0,r.kt)("p",null,"With above command you can specify the ",(0,r.kt)("inlineCode",{parentName:"p"},"gpg")," key last numbers (as used in ",(0,r.kt)("inlineCode",{parentName:"p"},"keybase"),") as well as validator details and your email for security contact~"),(0,r.kt)("h3",{id:"automating-your-validator-with-systemd"},"Automating your validator with systemd"),(0,r.kt)("p",null,"You will most likely want to automate your validator restarting if your server reboots. Below is a systemd unit file to place at ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/systemd/system/nymd.service"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ini"},'[Unit]\nDescription=Nymd (0.11.0)\nStartLimitInterval=350\nStartLimitBurst=10\n\n[Service]\nUser=nym                                                          # change to your user\nType=simple\nEnvironment="LD_LIBRARY_PATH=/home/youruser/path/to/nym/binaries" # change to correct path\nExecStart=/home/youruser/path/to/nym/binaries/nymd start          # change to correct path\nRestart=on-failure\nRestartSec=30\n\n[Install]\nWantedBy=multi-user.target\n')),(0,r.kt)("p",null,"Proceed to start it with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl daemon-reload # to pickup the new unit file\nsystemctl enable nymd   # to enable the service\nsystemctl start nymd    # to actually start the service\njournalctl -f           # to monitor system logs showing the service start\n")),(0,r.kt)("h3",{id:"installing-and-configuring-nginx-for-https"},"Installing and configuring nginx for HTTPS"),(0,r.kt)("h4",{id:"setup"},"Setup"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.nginx.com/resources/glossary/nginx/#:~:text=NGINX%20is%20open%20source%20software,%2C%20media%20streaming%2C%20and%20more.&text=In%20addition%20to%20its%20HTTP,%2C%20TCP%2C%20and%20UDP%20servers."},"Nginx")," is an open source software used for operating high-performance web servers. It allows us to set up reverse proxying on our validator server to improve performance and security."),(0,r.kt)("p",null,"Install ",(0,r.kt)("inlineCode",{parentName:"p"},"nginx")," and allow the 'Nginx Full' rule in your firewall:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo ufw allow 'Nginx Full'\n")),(0,r.kt)("p",null,"Check nginx is running via systemctl:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl status nginx\n")),(0,r.kt)("p",null,"Which should return:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"\u25cf nginx.service - A high performance web server and a reverse proxy server\n   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)\n   Active: active (running) since Fri 2018-04-20 16:08:19 UTC; 3 days ago\n     Docs: man:nginx(8)\n Main PID: 2369 (nginx)\n    Tasks: 2 (limit: 1153)\n   CGroup: /system.slice/nginx.service\n           \u251c\u25002369 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;\n           \u2514\u25002380 nginx: worker process\n")),(0,r.kt)("h4",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"Proxying your validator's port ",(0,r.kt)("inlineCode",{parentName:"p"},"26657")," to nginx port ",(0,r.kt)("inlineCode",{parentName:"p"},"80")," can then be done by creating a file with the following at ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/nginx/conf.d/validator.conf"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'server {\n  listen 80;\n  listen [::]:80;\n  server_name "{{ domain }}";\n\n  location / {\n    proxy_pass http://127.0.0.1:26657;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n  }\n}\n')),(0,r.kt)("p",null,"Followed by:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo apt install certbot nginx python3\ncertbot --nginx -d nym-validator.yourdomain.com -m you@yourdomain.com --agree-tos --noninteractive --redirect\n")),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"If using a VPS running Ubuntu 20: replace ",(0,r.kt)("inlineCode",{parentName:"p"},"certbot nginx python3")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"python3-certbot-nginx")))),(0,r.kt)("p",null,"These commands will get you an https encrypted nginx proxy in front of the API."),(0,r.kt)("h3",{id:"configuring-prometheus-metrics-optional"},"Configuring Prometheus metrics (optional)"),(0,r.kt)("p",null,"Configure Prometheus with the following commands (adapted from NodesGuru's ",(0,r.kt)("a",{parentName:"p",href:"https://nodes.guru/agoric/setup-guide/en"},"Agoric setup guide"),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"echo 'export OTEL_EXPORTER_PROMETHEUS_PORT=9464' >> $HOME/.bashrc\nsource ~/.bashrc\nsed -i '/\\[telemetry\\]/{:a;n;/enabled/s/false/true/;Ta}' $HOME/.nymd/config/app.toml\nsed -i \"s/prometheus-retention-time = 0/prometheus-retention-time = 60/g\" $HOME/.nymd/config/app.toml\nsudo ufw allow 9464\necho 'Metrics URL: http://'$(curl -s ifconfig.me)':26660/metrics'\n")),(0,r.kt)("p",null,"Your validator's metrics will be available to you at the returned 'Metrics URL', and look something like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'# HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.\n# TYPE go_gc_duration_seconds summary\ngo_gc_duration_seconds{quantile="0"} 6.7969e-05\ngo_gc_duration_seconds{quantile="0.25"} 7.864e-05\ngo_gc_duration_seconds{quantile="0.5"} 8.4591e-05\ngo_gc_duration_seconds{quantile="0.75"} 0.000115919\ngo_gc_duration_seconds{quantile="1"} 0.001137591\ngo_gc_duration_seconds_sum 0.356555301\ngo_gc_duration_seconds_count 2448\n# HELP go_goroutines Number of goroutines that currently exist.\n# TYPE go_goroutines gauge\ngo_goroutines 668\n# HELP go_info Information about the Go environment.\n# TYPE go_info gauge\ngo_info{version="go1.15.7"} 1\n# HELP go_memstats_alloc_bytes Number of bytes allocated and still in use.\n# TYPE go_memstats_alloc_bytes gauge\ngo_memstats_alloc_bytes 1.62622216e+08\n# HELP go_memstats_alloc_bytes_total Total number of bytes allocated, even if freed.\n# TYPE go_memstats_alloc_bytes_total counter\ngo_memstats_alloc_bytes_total 2.09341707264e+11\n# HELP go_memstats_buck_hash_sys_bytes Number of bytes used by the profiling bucket hash table.\n# TYPE go_memstats_buck_hash_sys_bytes gauge\ngo_memstats_buck_hash_sys_bytes 5.612319e+06\n# HELP go_memstats_frees_total Total number of frees.\n# TYPE go_memstats_frees_total counter\ngo_memstats_frees_total 2.828263344e+09\n# HELP go_memstats_gc_cpu_fraction The fraction of this program\'s available CPU time used by the GC since the program started.\n# TYPE go_memstats_gc_cpu_fraction gauge\ngo_memstats_gc_cpu_fraction 0.03357798610671518\n# HELP go_memstats_gc_sys_bytes Number of bytes used for garbage collection system metadata.\n# TYPE go_memstats_gc_sys_bytes gauge\ngo_memstats_gc_sys_bytes 1.3884192e+07\n')),(0,r.kt)("h3",{id:"unjailing-your-validator"},"Unjailing your validator"),(0,r.kt)("p",null,"If your validator gets jailed, you can fix it with the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"nymd tx slashing unjail \\\n  --broadcast-mode=block \\\n  --from=${FROM_ACCOUNT} \\\n  --chain-id=testnet-milhon \\\n  --gas=auto \\\n  --gas-adjustment=1.4 \\\n  --fees=7000upunk\n")),(0,r.kt)("h4",{id:"common-reasons-for-your-validator-being-jailed"},"Common reasons for your validator being jailed"),(0,r.kt)("p",null,"The most common reason for your validator being jailed is that your validator is out of memory because of bloated syslogs."),(0,r.kt)("p",null,"Running the command ",(0,r.kt)("inlineCode",{parentName:"p"},"df -H")," will return the size of the various partitions of your VPS."),(0,r.kt)("p",null,"If the ",(0,r.kt)("inlineCode",{parentName:"p"},"/dev/sda")," partition is almost full, try pruning some of the ",(0,r.kt)("inlineCode",{parentName:"p"},".gz")," syslog archives and restart your validator process."),(0,r.kt)("h3",{id:"day-2-operations-with-your-validator"},"Day 2 operations with your validator"),(0,r.kt)("p",null,"As part of the execution of the validator, it will be able to get some rewards."),(0,r.kt)("p",null,"With this command, we can query our outstanding rewards:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"nymd query distribution validator-outstanding-rewards <punkvaloperaddress>\n")),(0,r.kt)("p",null,"Using the values obtained from the previous command, you can withdraw all rewards with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'nymd tx distribution withdraw-rewards <punkvaloperaddress> --from ${FROM_ACCOUNT} --keyring-backend=os --chain-id="testnet-milhon" --gas="auto" --gas-adjustment=1.15 --commission --fees 5000upunk\n')),(0,r.kt)("p",null,"You can check your current balances with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"nymd query bank balances punk<address>\n")),(0,r.kt)("p",null,"For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'balances:\n- amount: "22976200"\ndenom: stake\n- amount: "919376"\ndenom: upunk\npagination:\nnext_key: null\ntotal: "0"\n')),(0,r.kt)("p",null,"You can, of course, stake back the available balance to your validator with the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},'nymd tx staking delegate <punkvaloperaddress> <amount>stake--from ${FROM_ACCOUNT} --keyring-backend=os --chain-id "testnet-milhon" --gas="auto" --gas-adjustment=1.15 --fees 5000upunk\n')),(0,r.kt)("p",null,"NOTE: The value to be used instead of the ",(0,r.kt)("inlineCode",{parentName:"p"},"<amount>stake")," can be calculated from the available balance. For example, if you've ",(0,r.kt)("inlineCode",{parentName:"p"},"999989990556")," in the balance, you can stake ",(0,r.kt)("inlineCode",{parentName:"p"},"999909990556"),", note that the 5th digit, has been changed from ",(0,r.kt)("inlineCode",{parentName:"p"},"8")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," to leave some room for fees (amounts are multiplied by 10^6)."),(0,r.kt)("p",null,"Also remember to replace ",(0,r.kt)("inlineCode",{parentName:"p"},"punkvaloper")," with your validator address and ",(0,r.kt)("inlineCode",{parentName:"p"},"nym-admin")," with the user you created during initialization."),(0,r.kt)("h3",{id:"validator-port-reference"},"Validator port reference"),(0,r.kt)("p",null,"All validator-specific port configuration can be found in ",(0,r.kt)("inlineCode",{parentName:"p"},"$HOME/.nymd/config/config.toml"),". If you do edit any port configs, remember to restart your validator."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Default port"),(0,r.kt)("th",{parentName:"tr",align:null},"Use"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1317"),(0,r.kt)("td",{parentName:"tr",align:null},"REST API server endpoint")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"1790"),(0,r.kt)("td",{parentName:"tr",align:null},"Listen for VerLoc traffic")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"8000"),(0,r.kt)("td",{parentName:"tr",align:null},"Metrics http API endpoint")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"26656"),(0,r.kt)("td",{parentName:"tr",align:null},"Listen for incoming peer connections")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"26660"),(0,r.kt)("td",{parentName:"tr",align:null},"Listen for Prometheus connections")))))}u.isMDXComponent=!0}}]);