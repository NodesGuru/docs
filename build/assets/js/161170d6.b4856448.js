"use strict";(self.webpackChunknym_docs=self.webpackChunknym_docs||[]).push([[5529],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},y={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),d=r,m=p["".concat(s,".").concat(d)]||p[d]||y[d]||i;return n?a.createElement(m,o(o({ref:t},u),{},{components:n})):a.createElement(m,o({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2188:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return u},default:function(){return p}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],l={sidebar_label:"Gateways",description:"Gateways provide a destination for mixnet packets. Most of the internet doesn't use encrypted Sphinx packets, so the gateway acts as a destination for Sphinx traffic.",hide_title:!1,title:"Gateways"},s=void 0,c={unversionedId:"run-nym-nodes/gateways",id:"version-0.11.0/run-nym-nodes/gateways",isDocsHomePage:!1,title:"Gateways",description:"Gateways provide a destination for mixnet packets. Most of the internet doesn't use encrypted Sphinx packets, so the gateway acts as a destination for Sphinx traffic.",source:"@site/versioned_docs/version-0.11.0/run-nym-nodes/gateways.md",sourceDirName:"run-nym-nodes",slug:"/run-nym-nodes/gateways",permalink:"/docs/0.11.0/run-nym-nodes/gateways",version:"0.11.0",lastUpdatedAt:1629392815,formattedLastUpdatedAt:"8/19/2021",frontMatter:{sidebar_label:"Gateways",description:"Gateways provide a destination for mixnet packets. Most of the internet doesn't use encrypted Sphinx packets, so the gateway acts as a destination for Sphinx traffic.",hide_title:!1,title:"Gateways"},sidebar:"version-0.11.0/sidebar",previous:{title:"Requesters",permalink:"/docs/0.11.0/run-nym-nodes/requester"},next:{title:"Mixnode Troubleshooting FAQ",permalink:"/docs/0.11.0/run-nym-nodes/troubleshooting"}},u=[{value:"Initializing your gateway",id:"initializing-your-gateway",children:[]},{value:"Running your gateway",id:"running-your-gateway",children:[]},{value:"Automating your gateway with systemd",id:"automating-your-gateway-with-systemd",children:[]},{value:"Gateway port reference",id:"gateway-port-reference",children:[]}],y={toc:u};function p(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},y,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The Nym gateway was built in the ",(0,i.kt)("a",{parentName:"p",href:"/docs/0.11.0/run-nym-nodes/build-nym/"},"building nym")," section. If you haven't yet built Nym and want to run the code, go there first."))),(0,i.kt)("p",null,"Gateways provide a destination for mixnet packets. Most of the internet doesn't use encrypted Sphinx packets, so the gateway acts as a destination, sort of like a mailbox, for messages."),(0,i.kt)("p",null,"Nym clients connect to gateways. Messages are automatically piped to connected clients and deleted from the gateway's disk storage. If a client is offline when a message arrives, it will be stored for later retrieval. When the client connects, all messages will be delivered, and deleted from the gateway's disk. As of release 0.8.x gateways use end-to-end encryption, so they cannot see the content of what they're storing for users."),(0,i.kt)("p",null,"When it starts up, a client registers itself with a gateway, and the gateway returns an access token. The access token plus the gateway's IP can then be used as a form of addressing for delivering packets."),(0,i.kt)("p",null,"The default gateway implementation included in the Nym platform code holds packets for later retrieval. For many applications (such as simple chat), this is usable out of the box, as it provides a place that potentially offline clients can retrieve packets from. The access token allows clients to pull messages from the gateway node."),(0,i.kt)("h3",{id:"initializing-your-gateway"},"Initializing your gateway"),(0,i.kt)("p",null,"You can check that your binaries are properly compiled with:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"./nym-gateway\n")),(0,i.kt)("p",null,"Which should return:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"\n      _ __  _   _ _ __ ___\n     | '_ \\| | | | '_ \\ _ \\\n     | | | | |_| | | | | | |\n     |_| |_|\\__, |_| |_| |_|\n            |___/\n\n             (gateway - version 0.11.0)\n\n\n\nusage: --help to see available options.\n")),(0,i.kt)("p",null,"To check available configuration options use:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"nym@localhost:~$ ./nym-gateway init --help\n")),(0,i.kt)("p",null,"In order to initialize your gateway the ",(0,i.kt)("inlineCode",{parentName:"p"},"id")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"host")," parameters are required, although feel free to experiment with adding any of the other flags output from the ",(0,i.kt)("inlineCode",{parentName:"p"},"--help")," command above:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"--announce-host <announce-host>        The host that will be reported to the directory server\n--clients-ledger <clients-ledger>      Ledger file containing registered clients\n--clients-port <clients-port>          The port on which the gateway will be listening for clients gateway-\n                                               requests\n--host <host>                          The custom host on which the gateway will be running for receiving sphinx\n                                               packets\n--id <id>                              Id of the gateway we want to create config for.\n--inboxes <inboxes>                    Directory with inboxes where all packets for the clients are stored\n--mix-port <mix-port>                  The port on which the gateway will be listening for sphinx packets\n--mixnet-contract <mixnet-contract>    Address of the validator contract managing the network\n--validators <validators>              Comma separated list of rest endpoints of the validators\n")),(0,i.kt)("p",null,"For example, the following command returns a gateway on your current IP with the ",(0,i.kt)("inlineCode",{parentName:"p"},"id")," of ",(0,i.kt)("inlineCode",{parentName:"p"},"supergateway"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"nym@localhost:~$ ./nym-gateway init --id supergateway --host $(curl ifconfig.me)\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100    14  100    14    0     0    125      0 --:--:-- --:--:-- --:--:--   123\n\n\n      _ __  _   _ _ __ ___\n     | '_ \\| | | | '_ \\ _ \\\n     | | | | |_| | | | | | |\n     |_| |_|\\__, |_| |_| |_|\n            |___/\n\n             (gateway - version 0.11.0)\n\n    \nInitialising gateway supergateway...\nSaved identity and mixnet sphinx keypairs\nSaved configuration file to \"/home/nym/.nym/gateways/supergateway/config/config.toml\"\nGateway configuration completed.\n\n\n\nPublic identity key: 398BwaVTnnA4Drv878Znmdiat1fGbQ1qgzxd3rZEfqRA\n\nPublic sphinx key: Gk1WYjVAGuyMFitJGxUGKH3TuvFvKx6B9amP7kzbFrSe\n\n\nTo bond your gateway you will [most likely] need to provide the following:\n    Identity key: 398BwaVTnnA4Drv878Znmdiat1fGbQ1qgzxd3rZEfqRA\n    Sphinx key: Gk1WYjVAGuyMFitJGxUGKH3TuvFvKx6B9amP7kzbFrSe\n    Host: 172.105.67.104\n    Mix Port: 1789\n    Clients Port: 9000\n    Location: [physical location of your node's server]\n")),(0,i.kt)("p",null,"Gateways ",(0,i.kt)("strong",{parentName:"p"},"must")," also be capable of addressing IPv6, which is something that is hard to come by with many ISPs. Running a gateway from behind your router will be tricky because of this, and we strongly recommend to run your gateway on a VPS. Additional to IPv6 connectivity, this will help maintain better uptime and connectivity."),(0,i.kt)("p",null,"Remember to bond your node via the ",(0,i.kt)("a",{parentName:"p",href:"https://testnet-milhon-wallet.nymtech.net/"},"Milhon Testnet web wallet"),"! This is required for the blockchain to recognize your node and its software version, and include your gateway in the mixnet. "),(0,i.kt)("h3",{id:"running-your-gateway"},"Running your gateway"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"run")," command runs the gateway."),(0,i.kt)("p",null,"Example:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"./nym-gateway run --id supergateway")),(0,i.kt)("p",null,"Results in:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'nym@localhost:~$ ./nym-gateway run --id supergateway\n\n\n      _ __  _   _ _ __ ___\n     | \'_ \\| | | | \'_ \\ _ \\\n     | | | | |_| | | | | | |\n     |_| |_|\\__, |_| |_| |_|\n            |___/\n\n             (gateway - version 0.11.0)\n\n\nStarting gateway supergateway...\nPublic sphinx key: Gk1WYjVAGuyMFitJGxUGKH3TuvFvKx6B9amP7kzbFrSe\n\nPublic identity key: 398BwaVTnnA4Drv878Znmdiat1fGbQ1qgzxd3rZEfqRA\n\nValidator servers: ["http://testnet-milhon-validator1.nymtech.net:1317"]\nListening for incoming packets on 172.105.67.104\nAnnouncing the following address: 172.105.67.104\nInboxes directory is: "/home/nym/.nym/gateways/supergateway/data/inboxes"\nClients ledger is stored at: "/home/nym/.nym/gateways/supergateway/data/client_ledger.sled"\n 2021-07-20T15:08:36.751Z INFO  nym_gateway::node > Starting nym gateway!\n 2021-07-20T15:08:36.849Z INFO  nym_gateway::node > Starting mix packet forwarder...\n 2021-07-20T15:08:36.849Z INFO  nym_gateway::node > Starting clients handler\n 2021-07-20T15:08:36.850Z INFO  nym_gateway::node > Starting mix socket listener...\n 2021-07-20T15:08:36.850Z INFO  nym_gateway::node::mixnet_handling::receiver::listener > Running mix listener on "172.105.67.104:1789"\n 2021-07-20T15:08:36.850Z INFO  nym_gateway::node::mixnet_handling::receiver::listener > Starting mixnet listener at 172.105.67.104:1789\n 2021-07-20T15:08:36.850Z INFO  nym_gateway::node                                      > Starting client [web]socket listener...\n 2021-07-20T15:08:36.850Z INFO  nym_gateway::node::client_handling::websocket::listener > Starting websocket listener at 172.105.67.104:9000\n 2021-07-20T15:08:36.850Z INFO  nym_gateway::node                                       > Finished nym gateway startup procedure - it should now be able to receive mix and client traffic!\n\n')),(0,i.kt)("h4",{id:"configure-your-firewall"},"Configure your firewall"),(0,i.kt)("p",null,"Although your gateway is now ready to receive traffic, your server may not be - the following commands will allow you to set up a properly configured firewall using ",(0,i.kt)("inlineCode",{parentName:"p"},"ufw"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"# check if you have ufw installed\nufw version\n# if it is not installed, install with\nsudo apt install ufw -y\n# enable ufw\nsudo ufw enable\n# check the status of the firewall\nsudo ufw status\n")),(0,i.kt)("p",null,"Finally open your gateway's p2p port, as well as ports for ssh and incoming traffic connections:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"sudo ufw allow 1789,22,9000/tcp\n# check the status of the firewall\nsudo ufw status\n")),(0,i.kt)("p",null,"For more information about your gateway's port configuration, check the ",(0,i.kt)("a",{parentName:"p",href:"#gateway-port-reference"},"gateway port reference table")," below."),(0,i.kt)("h3",{id:"automating-your-gateway-with-systemd"},"Automating your gateway with systemd"),(0,i.kt)("p",null,"Although it's not totally necessary, it's useful to have the gateway automatically start at system boot time. Here's a systemd service file to do that:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ini"},"[Unit]\nDescription=Nym Gateway (0.11.0)\nStartLimitInterval=350\nStartLimitBurst=10\n\n[Service]\nUser=nym\nLimitNOFILE=65536\nExecStart=/home/nym/nym-gateway run --id supergateway\nKillSignal=SIGINT\nRestart=on-failure\nRestartSec=30\n\n[Install]\nWantedBy=multi-user.target\n")),(0,i.kt)("p",null,"Put the above file onto your system at ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/systemd/system/nym-gateway.service"),"."),(0,i.kt)("p",null,"Change the path in ",(0,i.kt)("inlineCode",{parentName:"p"},"ExecStart")," to point at your gateway binary (",(0,i.kt)("inlineCode",{parentName:"p"},"nym-gateway"),"), and the ",(0,i.kt)("inlineCode",{parentName:"p"},"User")," so it is the user you are running as."),(0,i.kt)("p",null,"If you have built nym on your server, and your username is ",(0,i.kt)("inlineCode",{parentName:"p"},"jetpanther"),", then the start command might look like this:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ExecStart=/home/jetpanther/nym/target/release/nym-gateway run --id your-id"),". Basically, you want the full ",(0,i.kt)("inlineCode",{parentName:"p"},"/path/to/nym-gateway run --id whatever-your-node-id-is")),(0,i.kt)("p",null,"Then run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl enable nym-gateway.service\n")),(0,i.kt)("p",null,"Start your node:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"service nym-gateway start\n")),(0,i.kt)("p",null,"This will cause your node to start at system boot time. If you restart your machine, the node will come back up automatically."),(0,i.kt)("p",null,"You can also do ",(0,i.kt)("inlineCode",{parentName:"p"},"service nym-gateway stop")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"service nym-gateway restart"),"."),(0,i.kt)("p",null,"Note: if you make any changes to your systemd script after you've enabled it, you will need to run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"systemctl daemon-reload\n")),(0,i.kt)("p",null,"This lets your operating system know it's ok to reload the service configuration."),(0,i.kt)("h3",{id:"gateway-port-reference"},"Gateway port reference"),(0,i.kt)("p",null,"All gateway-specific port configuration can be found in ",(0,i.kt)("inlineCode",{parentName:"p"},"$HOME/.nym/gateways/<your-id>/config/config.toml"),". If you do edit any port configs, remember to restart your gateway."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Default port"),(0,i.kt)("th",{parentName:"tr",align:null},"Use"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"1789"),(0,i.kt)("td",{parentName:"tr",align:null},"Listen for Mixnet traffic")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"9000"),(0,i.kt)("td",{parentName:"tr",align:null},"Listen for Client traffic")))))}p.isMDXComponent=!0}}]);